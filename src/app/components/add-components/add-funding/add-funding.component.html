<!-- HTML component for ADD/Edit Financial agreemnt -->
<ng-container *ngIf="authorised_flag==false">
  <h6 style="text-align: center;">** You Don't have Authorization to View this Page **</h6>
</ng-container>
<ng-container *ngIf="authorised_flag==true">
  <!-- <div style="display: none"> -->
    <!--YOU NEED TO PUT THE COMPONENT INSIDE A HIDDEN DIV-->

    <!-- <app-exchange-rate-administration #exchangeRateAlert></app-exchange-rate-administration>
  </div> -->
  <mat-card>
    <div class="mt-2">

      <div class="example-container">

        <mat-accordion class="example-headers-align">

          <form id="general_information_form" [formGroup]="general_information_form" (change)="validateOnChange()">

            <input type="hidden" formname="financialAgreementId">
            <mat-expansion-panel [expanded]="step === 0" (opened)="setStep(0)" hideToggle
              class="custom-expansion-panel custom-panel-overflow">

              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h6>
                    {{ "add-funding.funding/general information" | translate }}
                  </h6>
                </mat-panel-title>
                <mat-panel-description></mat-panel-description>
                <mat-icon></mat-icon>
              </mat-expansion-panel-header>

              <div class="container-fluid">
                <div class="row">
                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <strong class="mandatory">*</strong>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-funding-donor-title">{{
                          "add-funding.funding-donor-title" | translate
                          }}
                        </span></mat-label>
                      <input matInput #fundingDonorTitle maxlength="150" placeholder="" autocomplete="off"
                        formControlName="funding_donor_title"
                        (change)="checkDuplicateFundingDonorTitle(fundingDonorTitle.value)"
                        (blur)="enableUploadBtn();" />
                      <mat-hint align="end">{{ fundingDonorTitle.value?.length ||
                        0 }}/150</mat-hint>
                    </mat-form-field>
                  </div>

                  <ng-container *ngIf="EditId == null && viewMoreId==null">
                    <!-- <div style="float: right;"> -->
                    <div class="col-xl-4 col-lg-4 col-sm-12 justify-content-end d-flex"
                      style="margin-left: auto; margin-right: 0;">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span>{{ 'create-envelope.save-as-draft' | translate }}</span></mat-label>
                        <mat-select [formControl]="SaveAsDraft" (selectionChange)="editDraftData()" (openedChange)="searchDraft.patchValue('')"
                          (click)="checkData()">
                          <div class="select-container" *ngIf="draftfilteredOption">
                            <mat-optgroup>
                                <mat-form-field style="width:100%;">
                                    <input autocomplete="off" placeholder="Search" aria-label="Search"
                                        matInput [formControl]="searchDraft">
                                    <button [disableRipple]="true" *ngIf="searchDraft.value" matSuffix mat-icon-button
                                        aria-label="Clear" (click)="searchDraft.patchValue('')">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                </mat-form-field>
                            </mat-optgroup>
                            <mat-optgroup *ngIf="(draftfilteredOption | async).length == 0">
                                <div>{{'common.No results found!' | translate}}</div>
                            </mat-optgroup>
                          <mat-option *ngFor="let option of draftfilteredOption | async" [value]="option.financialAgreementId">
                            DraftID-{{option.financialAgreementId}} &nbsp; {{option.updatedOn}}
                          </mat-option>
                        </div>
                        </mat-select>
                      </mat-form-field>
                      <!-- </div> -->
                    </div>
                  </ng-container>
                </div>
              </div>
              <div class="container-fluid">
                <div class="row">
                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <strong class="mandatory">*</strong>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-donor-funding-reference">{{
                          "add-funding.donor-for-funding-reference" | translate
                          }}</span></mat-label>
                      <input #fundingDonorRef matInput maxlength="150" placeholder=""
                        formControlName="donor_funding_reference" autocomplete="off"
                        (change)="checkDuplicateFundingDonorReference(fundingDonorRef.value,fundingOrg.value)" />
                      <!-- <mat-hint align="end">{{fundingDonorTitle.value?.length || 0}}/150</mat-hint> -->
                    </mat-form-field>
                  </div>

                  <div class="col-xl-4 col-lg-4 col-sm-12 col-lap-dv-4">
                    <strong class="mandatory">*</strong>
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-financing-situation">{{
                          "add-funding.financing-situation" | translate
                          }}</span></mat-label>
                      <mat-select (openedChange)="searchFinancingSituaion.patchValue('')"
                        (selectionChange)="validateOnChange()" placeholder="Select"
                        formControlName="financing_situatuion">
                        <div class="select-container" *ngIf="financingSituationfilteredOption">
                          <mat-optgroup>
                            <mat-form-field style="width: 100%">
                              <input #searchFS autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                [formControl]="searchFinancingSituaion" />
                              <button [disableRipple]="true" *ngIf="searchFS.value" matSuffix mat-icon-button
                                aria-label="Clear" (click)="searchFinancingSituaion.patchValue('')">
                                <mat-icon>close</mat-icon>
                              </button>
                            </mat-form-field>
                          </mat-optgroup>
                          <mat-optgroup *ngIf="(financingSituationfilteredOption | async).length == 0">
                            <div>{{'common.No results found!' | translate}}</div>
                          </mat-optgroup>
                          <ng-container *ngIf="browserLang== 'en'">
                            <mat-option *ngFor="let option of
                            financingSituationfilteredOption
                            | async" [value]="option.financingSituationId">
                              <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                              </ng-container>
                              {{ option.financingSituationNameEn }}
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="browserLang== 'pt'">
                            <mat-option *ngFor="let option of
                            financingSituationfilteredOption
                            | async" [value]="option.financingSituationId">
                              <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                              </ng-container>
                              {{ option.financingSituationNamePt }}
                            </mat-option>
                          </ng-container>
                        </div>
                      </mat-select>
                    </mat-form-field>
                    <i class="fas
                      fa-info-circle
                      info-font
                      mr-3
                      carte_button
                      custom-carte2"></i>
                    <div class="carte custom-carte2">
                      <ul>
                        <li>
                          {{
                          "add-funding.financial-situation-Identification" | translate
                          }}
                        </li>
                        <li>
                          {{ 
                            "add-funding.financial-situation-Signed" | translate
                          }}
                        </li>
                        <li>
                          {{
                          "add-funding.financial-situation-Ongoing" | translate
                          }}
                        </li>
                        <li>
                          {{
                          "add-funding.financial-situation-Suspended" | translate
                          }}
                        </li>
                        <li>
                          {{
                          "add-funding.financial-situation-Cancelled" | translate
                          }}
                        </li>
                        <li>
                          {{
                          "add-funding.financial-situation-finalization" | translate
                          }}
                        </li>
                        <li>
                          {{
                          "add-funding.financial-situation-Completed" | translate
                          }}
                        </li>
                      </ul>
                    </div>

                  </div>
                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <strong class="mandatory">*</strong>
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-type-of-aid-dac-crs">{{
                          "add-funding.co-operation-modality" | translate
                          }}</span></mat-label>
                      <mat-select (openedChange)="searchTypeOfAid.patchValue('')" (selectionChange)="validateOnChange()"
                        placeholder="Select" formControlName="type_of_aid">
                        <div class="select-container" *ngIf="aidDACCRSfilteredOption">
                          <mat-optgroup>
                            <mat-form-field style="width: 100%">
                              <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                [formControl]="searchTypeOfAid" />
                              <button [disableRipple]="true" *ngIf="searchTypeOfAid.value" matSuffix mat-icon-button
                                aria-label="Clear" (click)="searchTypeOfAid.patchValue('')">
                                <mat-icon>close</mat-icon>
                              </button>
                            </mat-form-field>
                          </mat-optgroup>
                          <mat-optgroup *ngIf="(aidDACCRSfilteredOption |
                            async).length == 0">
                            <div>{{'common.No results found!' | translate}}</div>
                          </mat-optgroup>
                          <ng-container *ngIf="browserLang == 'en'">
                            <mat-option *ngFor="let option of
                            aidDACCRSfilteredOption | async" [value]="option.dacCrsId"
                              matTooltip="{{ option.dacCrsNameEn }}" [matTooltipPosition]="'right'"
                              matTooltipClass="custom-tooltip">
                              <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                              </ng-container>
                              {{ option.dacCrsNameEn }}
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="browserLang == 'pt'">
                            <mat-option *ngFor="let option of
                            aidDACCRSfilteredOption | async" [value]="option.dacCrsId"
                              matTooltip="{{ option.dacCrsNamePt }}" [matTooltipPosition]="'right'"
                              matTooltipClass="custom-tooltip">
                              <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                              </ng-container>
                              {{ option.dacCrsNamePt}}
                            </mat-option>
                          </ng-container>
                        </div>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">
                  <div class="col-xl-4 col-lg-4 col-sm-12"
                    *ngIf="general_information_form.controls.type_of_aid.value==1">
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-type-of-aid-dac-crs"></span>{{"add-funding.Budget Support" |
                        translate}}</mat-label>
                      <mat-select (openedChange)="searchBudgetSupport.patchValue('')"
                        formControlName="budgetSupportOptions" (selectionChange)="budgetSupportRule()">
                        <div class="select-container" *ngIf="budgetSupportfilteredOption">
                          <mat-optgroup>
                            <mat-form-field style="width: 100%">
                              <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                [formControl]="searchBudgetSupport" />
                              <button [disableRipple]="true" *ngIf="searchBudgetSupport.value" matSuffix mat-icon-button
                                aria-label="Clear" (click)="searchBudgetSupport.patchValue('')">
                                <mat-icon>close</mat-icon>
                              </button>
                            </mat-form-field>
                          </mat-optgroup>
                          <mat-optgroup *ngIf="(budgetSupportfilteredOption |
                              async).length == 0">
                            <div>{{'common.No results found!' | translate}}</div>
                          </mat-optgroup>
                          <ng-container *ngIf="browserLang == 'en'">
                            <mat-option *ngFor="let option of
                            budgetSupportfilteredOption | async" [value]="option.budgetMasterId"
                              matTooltip="{{ option.nameEn }}" [matTooltipPosition]="'right'"
                              matTooltipClass="custom-tooltip">
                              {{ option.nameEn }}
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="browserLang == 'pt'">
                            <mat-option *ngFor="let option of
                              budgetSupportfilteredOption | async" [value]="option.budgetMasterId"
                              matTooltip="{{ option.namePt }}" [matTooltipPosition]="'right'"
                              matTooltipClass="custom-tooltip">
                              {{ option.namePt }}
                            </mat-option>
                          </ng-container>

                        </div>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <ng-container *ngIf="donor_and_funding_organization_mandatory_flag
                        == true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="donor_and_funding_organization_mandatory_flag
                        == false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-donor">{{ "add-funding.donor"
                          | translate }}
                        </span>
                      </mat-label>
                      <mat-select #donor (openedChange)="searchDonor.patchValue('')" (selectionChange)="getEnvelopeReference(fundingOrg.value,donor.value);validateOnChange();
                          getFundingOrganizationDetails()" placeholder="Select" formControlName="donor">
                        <div class="select-container" *ngIf="donorfilteredOption">
                          <mat-optgroup>
                            <mat-form-field style="width: 100%">
                              <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                [formControl]="searchDonor" />
                              <button [disableRipple]="true" *ngIf="searchDonor.value" matSuffix mat-icon-button
                                aria-label="Clear" (click)="searchDonor.patchValue('')">
                                <mat-icon>close</mat-icon>
                              </button>
                            </mat-form-field>
                          </mat-optgroup>
                          <mat-optgroup *ngIf="(donorfilteredOption |
                              async).length == 0">
                            <div>{{'common.No results found!' | translate}}</div>
                          </mat-optgroup>
                          <mat-option *ngFor="let option of donorfilteredOption |
                              async" [value]="option.id">
                            {{ option.names }}
                          </mat-option>
                        </div>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-sm-12 col-lap-dv-4">
                    <ng-container *ngIf="donor_and_funding_organization_mandatory_flag
                        == true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="donor_and_funding_organization_mandatory_flag
                        == false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-funding-organization">{{
                          "add-funding.funding-organization" | translate
                          }}</span></mat-label>

                      <mat-select #fundingOrg (openedChange)="searchFundingOrganization.patchValue('')"
                        (selectionChange)="getEnvelopeReference(fundingOrg.value,donor.value);checkDuplicateFundingDonorReference(fundingDonorRef.value,fundingOrg.value);validateOnChange();
                        getFundingOrgNm($event);getMpoData()"
                        placeholder="Select" formControlName="funding_organization">
                        <div class="select-container" *ngIf="fundingOrganizationfilteredOption">
                          <mat-optgroup>
                            <mat-form-field style="width: 100%">
                              <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                [formControl]="searchFundingOrganization" />
                              <button [disableRipple]="true" *ngIf="searchFundingOrganization.value" matSuffix
                                mat-icon-button aria-label="Clear" (click)="searchFundingOrganization.patchValue('')">
                                <mat-icon>close</mat-icon>
                              </button>
                            </mat-form-field>
                          </mat-optgroup>
                          <mat-optgroup *ngIf="(fundingOrganizationfilteredOption
                              | async)
                              .length == 0">
                            <div>{{'common.No results found!' | translate}}</div>
                          </mat-optgroup>
                          <mat-option *ngFor="let option of
                              fundingOrganizationfilteredOption
                              | async" [value]="option.id">
                            {{ option.names }}
                          </mat-option>
                        </div>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>


                <div class="row">



                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <ng-container *ngIf="responsible_organization_mandatory_flag == true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="responsible_organization_mandatory_flag
                      == false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-responsible-organization">{{
                          "add-funding.responsible-organization" | translate
                          }}</span></mat-label>

                      <mat-select (openedChange)="searchResponsibleOrganization.patchValue('')"
                        (selectionChange)="validateOnChange()" placeholder="Select"
                        formControlName="responsible_organization">
                        <div class="select-container" *ngIf="responsibleOrganizationfilteredOption">
                          <mat-optgroup>
                            <mat-form-field style="width: 100%">
                              <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                [formControl]="searchResponsibleOrganization" />
                              <button [disableRipple]="true" *ngIf="searchResponsibleOrganization.value" matSuffix
                                mat-icon-button aria-label="Clear"
                                (click)="searchResponsibleOrganization.patchValue('')">
                                <mat-icon>close</mat-icon>
                              </button>
                            </mat-form-field>
                          </mat-optgroup>
                          <mat-optgroup *ngIf="(responsibleOrganizationfilteredOption
                            | async)
                            .length == 0">
                            <div>{{'common.No results found!' | translate}}</div>
                          </mat-optgroup>
                          <mat-option *ngFor="let option of
                            responsibleOrganizationfilteredOption
                            | async" [value]="option.id">
                            {{ option.names }}
                          </mat-option>
                          <!-- <mat-option *ngFor="let option of
                            responsibleOrganizationfilteredOption
                            | async"[value]="option.responsibleOrganizationId">
                            <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                              <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                            </ng-container>
                            {{ option.responsibleOrganizationName }}
                          </mat-option> -->
                        </div>
                      </mat-select>
                    </mat-form-field>
                  </div>



                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <ng-container *ngIf="date_of_signature_mandatory_flag ==
                      true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="date_of_signature_mandatory_flag ==
                      false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-date-of-signature">
                          {{ "add-funding.date-of-signature" | translate }}
                        </span></mat-label>
                      <input matInput [matDatepicker]="picker1" formControlName="date_of_signature"
                        (dateChange)="validateOnChange()" autocomplete="off" style="cursor: pointer"
                        (focus)="picker1?.open()" [max]="general_information_form.controls['start_date'].value"
                        #date_of_signature />
                      <ng-container *ngIf="viewMoreId == null">
                        <mat-icon matDatepickerToggleIcon (click)="clearSignatureDate($event)">clear</mat-icon>
                      </ng-container>
                      <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                      <mat-datepicker #picker1 [disabled]="pickerDisable_flag_date_of_signature">
                      </mat-datepicker>
                      <!-- <mat-error *ngIf="hasError('date_of_signature', 'required')">Date of signature is required</mat-error> -->
                    </mat-form-field>
                    <!-- <mat-error *ngIf="date_of_signature.value > start_date.value"> Date of signature must be before Start Date</mat-error> -->
                  </div>

                  <div class="col-xl-4 col-lg-4 col-sm-12 col-lap-dv-4">
                    <ng-container *ngIf="start_and_end_date_mandatory_flag ==
                      true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="start_and_end_date_mandatory_flag ==
                      false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-start-date">
                          {{ "add-funding.start-date" | translate }}
                        </span></mat-label>
                      <input matInput [min]="general_information_form.controls['date_of_signature']
                        .value" [max]="general_information_form.controls['end_date'].value" [matDatepicker]="picker2"
                        formControlName="start_date" (dateChange)="validateOnChange();getMpoData();
                        populateYear(); addCommitmentData()" autocomplete="off" style="cursor: pointer"
                        (focus)="picker2?.open()" #start_date readonly />
                      <ng-container *ngIf="viewMoreId == null">
                        <mat-icon matDatepickerToggleIcon
                          (click)="clearStartDate($event);populateYear();clearCommitmentFormArray()">clear</mat-icon>
                      </ng-container>
                      <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                      <mat-datepicker #picker2 [disabled]="pickerDisable_flag"></mat-datepicker>
                      <!-- <mat-error *ngIf="hasError('start_date', 'required')">Start date  is required</mat-error> -->
                      <!-- <mat-error *ngIf="error.isError" class="alert alert-danger"> {{ error.errorMessage }}</mat-error> -->
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">



                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <ng-container *ngIf="start_and_end_date_mandatory_flag ==
                      true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="start_and_end_date_mandatory_flag ==
                      false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0">
                      <mat-label><span class="label-end-date">
                          {{ "add-funding.end-date" | translate }}
                        </span></mat-label>
                      <input matInput [min]="general_information_form.controls['start_date'].value"
                        [matDatepicker]="picker3" formControlName="end_date" (dateChange)="validateOnChange();
                        populateYear();getMpoData(); addCommitmentData()" autocomplete="off" style="cursor: pointer"
                        (focus)="picker3?.open()" readonly />
                      <ng-container *ngIf="viewMoreId == null">
                        <mat-icon matDatepickerToggleIcon
                          (click)="clearEndDate($event);populateYear();clearCommitmentFormArray()">clear</mat-icon>
                      </ng-container>
                      <mat-datepicker-toggle matSuffix [for]="picker3"></mat-datepicker-toggle>
                      <mat-datepicker #picker3 [disabled]="pickerDisable_flag"></mat-datepicker>
                      <!-- <mat-error *ngIf="hasError('end_date', 'required')">End date  is required</mat-error> -->
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-come-in-like">{{
                          "add-funding.come-in-like" | translate
                          }}</span></mat-label>
                      <mat-select formControlName="come_in_like">
                        <!-- <mat-option>None</mat-option> -->
                        <ng-container *ngIf="browserLang == 'en'">
                          <mat-option value="1">In Currency</mat-option>
                          <mat-option value="2">In Kind</mat-option>
                        </ng-container>
                        <ng-container *ngIf="browserLang == 'pt'">
                          <mat-option value="1">Em moeda</mat-option>
                          <mat-option value="2">Em espécie</mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>
                  <div class="col-xl-4 col-lg-4 col-sm-12 col-lap-dv-4">
                    <!-- <strong class="mandatory">*</strong> -->
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-type-of-implementation">{{
                          "add-funding.type-of-implementation" | translate
                          }}</span></mat-label>
                      <mat-select formControlName="type_of_implementation" multiple>
                        <ng-container *ngIf="browserLang == 'en'">
                          <mat-option *ngFor="let option of
                          typeOfImplementationList" [value]="option.typeOfImplementationId">
                            <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                              <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                            </ng-container>
                            {{ option.typeOfImplementationName }}
                          </mat-option>
                        </ng-container>
                        <ng-container *ngIf="browserLang == 'pt'">
                          <mat-option *ngFor="let option of
                            typeOfImplementationList" [value]="option.typeOfImplementationId">
                            <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                              <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                            </ng-container>
                            {{ option.typeOfImplementationNamePt}}
                          </mat-option>
                        </ng-container>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>
                <div class="row">



                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <strong class="mandatory">*</strong>
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-state-budget">
                          {{ "add-funding.state-budget" | translate }}
                        </span></mat-label>
                      <mat-select formControlName="state_budget" (selectionChange)="stateBudgetBusinessRule();
                        validateOnChange();getMpoData()">
                        <ng-container *ngIf="browserLang == 'en'">
                          <mat-option *ngFor="let state_budget_Indicator of
                          stateBudgetList" [value]="state_budget_Indicator.stateBudgetId">
                            <ng-container
                              *ngIf="state_budget_Indicator.difference<=7 || state_budget_Indicator.updateDifference<=7">
                              <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                            </ng-container>
                            {{ state_budget_Indicator.stateBudget }}
                          </mat-option>
                        </ng-container>
                        <ng-container *ngIf="browserLang == 'pt'">
                          <mat-option *ngFor="let state_budget_Indicator of
                              stateBudgetList" [value]="state_budget_Indicator.stateBudgetId">
                            <ng-container
                              *ngIf="state_budget_Indicator.difference<=7 || state_budget_Indicator.updateDifference<=7">
                              <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                            </ng-container>
                            {{ state_budget_Indicator.stateBudgetPt }}
                          </mat-option>
                        </ng-container>
                      </mat-select>
                      <!-- <mat-error *ngIf="hasError('provinces', 'required')"></mat-error> -->
                    </mat-form-field>
                  </div>
                  <ng-container *ngIf="treasury_single_account_mandatory_flag ==
                    true">
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <strong class="mandatory">*</strong>
                      <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                        <mat-label><span class="label-treasury-single-account">{{
                            "add-funding.treasury-single-account" | translate
                            }}</span></mat-label>
                        <mat-select (selectionChange)="validateOnChange()" formControlName="treasury_single_account">
                          <!-- <mat-option>None</mat-option> -->
                          <ng-container *ngIf="browserLang == 'en'">
                            <mat-option value="1">On CUT</mat-option>
                            <mat-option value="2">Off CUT</mat-option>
                          </ng-container>
                          <ng-container *ngIf="browserLang == 'pt'">
                            <mat-option value="1">Na CUT</mat-option>
                            <mat-option value="2">Fora da CUT</mat-option>
                          </ng-container>
                        </mat-select>
                      </mat-form-field>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="treasury_single_account_mandatory_flag ==
                    false">
                  </ng-container>
                  <ng-container *ngIf="direct_implementation_mandatory_flag ==
                    true">
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <strong class="mandatory">*</strong>
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-direct-implementation">{{
                            "add-funding.direct-implementation" | translate
                            }}</span></mat-label>
                        <mat-select (selectionChange)="validateOnChange()" formControlName="direct_implementation">
                          <!-- <mat-option>None</mat-option> -->
                          <mat-option value="1">{{"common.Donor uses intermediaries
                            for implementation" | translate}}
                          </mat-option>
                          <mat-option value="2">{{"common.Donor implements directly" | translate}}</mat-option>

                        </mat-select>
                      </mat-form-field>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="direct_implementation_mandatory_flag ==
                    false">
                  </ng-container>

                  <!-- <div class="row"> -->
                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <ng-container *ngIf="pillar_pqg_meo_mandatory_flag == true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="pillar_pqg_meo_mandatory_flag == false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-pillar-pqg-meo">
                          {{ "add-funding.pillar-PQG-MEO" | translate }}</span></mat-label>
                      <mat-select formControlName="pillar_pqg_meo" (selectionChange)="validateOnChange();
                        getStrategicPqgMeo()" multiple>
                        <mat-optgroup *ngFor="let group of priority_pillar_list" [label]="group.name"
                          [disabled]="group.disabled" class="mat-option-text">
                          <!-- <mat-optgroup *ngFor="let group of pillar_and_strategic_group1" class="mat-option-text"></mat-optgroup> -->
                          <ng-container *ngIf="browserLang == 'en'">
                            <mat-option *ngFor="let option of group.options" [value]="option.value"
                              matTooltip="{{ option.viewValue }}" [matTooltipPosition]="'right'"
                              matTooltipClass="custom-tooltip">
                              {{ option.viewValue }}
                            </mat-option>
                          </ng-container>
                          <ng-container *ngIf="browserLang == 'pt'">
                            <mat-option *ngFor="let option of group.options" [value]="option.value"
                              matTooltip="{{ option.viewValuePt }}" [matTooltipPosition]="'right'"
                              matTooltipClass="custom-tooltip">
                              {{ option.viewValuePt }}
                            </mat-option>
                          </ng-container>
                        </mat-optgroup>
                      </mat-select>
                    </mat-form-field>
                  </div>
                </div>

                <div class="row">



                  <div class="col-xl-4 col-lg-4 col-sm-12">
                    <ng-container *ngIf="strategic_objective_pqg_meo_mandatory_flag == true">
                      <strong class="mandatory">*</strong>
                    </ng-container>
                    <ng-container *ngIf="strategic_objective_pqg_meo_mandatory_flag == false">
                    </ng-container>
                    <mat-form-field appearance="outline" class="mb-form-0" (click)="getValueByLang()">
                      <mat-label><span class="label-strategic-objective-pqg-meo">{{
                          "add-funding.strategic-objective PQG MEO"
                          | translate
                          }}</span></mat-label>
                      <mat-select formControlName="strategic_objective_pqg_meo" (selectionChange)="validateOnChange()">
                        <ng-container *ngIf="browserLang == 'en'">
                          <mat-option *ngFor="let option of
                          strategicPqgMeo" [value]="option.strategicObjPqgMeoId"
                            matTooltip="{{ option.strategicObjPqgMeoName }}" [matTooltipPosition]="'right'"
                            matTooltipClass="custom-tooltip">
                            {{ option.strategicObjPqgMeoName }}
                          </mat-option>
                        </ng-container>
                        <ng-container *ngIf="browserLang == 'pt'">
                          <mat-option *ngFor="let option of
                            strategicPqgMeo" [value]="option.strategicObjPqgMeoId"
                            matTooltip="{{ option.strategicObjPqgMeoNamePt }}" [matTooltipPosition]="'right'"
                            matTooltipClass="custom-tooltip">
                            {{ option.strategicObjPqgMeoNamePt }}
                          </mat-option>
                        </ng-container>
                        <!-- <ng-container *ngIf="browserLang == 'en'">
                        <mat-option *ngFor="let option of
                          strategic_objective_options" [value]="option.value"
                          matTooltip="{{ option.viewValue }}"
                          [matTooltipPosition]="'right'"
                          matTooltipClass="custom-tooltip">
                          {{ option.viewValue }}
                        </mat-option>
                        </ng-container>
                        <ng-container *ngIf="browserLang == 'pt'">
                          <mat-option *ngFor="let option of
                            strategic_objective_options" [value]="option.value"
                            matTooltip="{{ option.viewValuePt }}"
                            [matTooltipPosition]="'right'"
                            matTooltipClass="custom-tooltip">
                            {{ option.viewValuePt }}
                          </mat-option>
                          </ng-container> -->

                        <!-- <mat-option *ngFor="let option of strategic_objective_pqg_meo_group1" [value]="option">{{ option }}
                                              </mat-option> -->
                        <!-- <mat-option *ngFor="let option of strategicPqgMeo" [value]="option.strategicObjPqgMeoName">
                                                  {{ option.strategicObjPqgMeoName }}
                                              </mat-option> -->
                      </mat-select>
                    </mat-form-field>
                  </div>

                </div>

                <div class="row">

                  <div class="col-xl-12 col-lg-12 col-sm-12 pr-0">
                    <h6>
                      <b>{{ "add-project.comments" | translate }} </b>
                    </h6>
                    <div class="table-responsive">
                      <table class="table table-striped table-bordered" formArrayName="tableFundingComments">
                        <tr>
                          <ng-container *ngIf="viewMoreId==null">
                            <th class="add-comments">
                              <button (click)="addCommentRow()" class="btn
                                btn-success btn-sm label-add">
                                {{ "common.add" | translate }}
                              </button>
                            </th>
                          </ng-container>
                          <th *ngFor="let column of commentHeaders">
                            <ng-container *ngIf="column === 'Comments'">
                              {{ "add-project.comments" | translate }}
                            </ng-container>
                          </th>
                        </tr>
                        <tr *ngFor="let row of general_information_form.get(
                          'tableFundingComments'
                          )['controls'];
                          let j= index">
                          <ng-container *ngIf="viewMoreId==null">
                            <td class="whitesp-nowrap del-cmt">
                              <ng-container *ngIf="this.permissionDeleteComment[j]==true">
                                <button popover-trigger="'mouseenter'" uib-popover="Delete"
                                  class="btn btn-danger btn-sm mt-3 ml-2" (click)="deleteCommentsRow(j)">
                                  <i class="fa fa-trash" aria-hidden="true"></i>
                                </button>
                              </ng-container>
                            </td>
                          </ng-container>
                          <td class="whitesp-nowrap" *ngFor="let column of
                            commentHeaders">
                            <ng-container>
                              <ng-container [formGroupName]="j">
                                <ng-container *ngIf="column === 'Comments';
                                  then manageComments">
                                </ng-container>
                                <ng-template #manageComments>
                                  <mat-form-field appearance="outline" class="mb-form-0">
                                    <input type="hidden" formname="financialAgreementId">
                                    <mat-label><span class="label-comments">{{
                                        "add-project.comments" | translate }}
                                      </span></mat-label>
                                    <textarea matInput #comments maxlength="1000" placeholder="{{
                                      'add-project.comments' | translate }}"
                                      formControlName="comments" cols="30" rows="4"
                                      (blur)="generateCommentsData(j)"></textarea>
                                    <mat-hint align="end">{{
                                      comments.value?.length || 0
                                      }}/1000</mat-hint>
                                  </mat-form-field>
                                </ng-template>
                              </ng-container>
                            </ng-container>
                            <mat-label class="col-xl-4 col-lg-4 col-sm-12 pt-2">
                              <span class="label-comment-by">{{"common.Commented By" | translate}} {{
                                commentsData[j].commentedBy }},
                                {{ commentsData[j].commentedOn }}</span>
                            </mat-label>
                          </td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </div>
                <div class="row"></div>
                <button class="checkValidation" [hidden]="true">
                </button>
                <ng-container *ngIf="EditId == null &&
                viewMoreId==null">
                  <mat-action-row class="border-top-none">
                    <button class="btn btn-outline-primary btn-sm mr-2
                      label-reset" (click)="clearForm1(general_information_form)">
                      {{ "common.reset" | translate }}
                    </button>
                    <button class="btn btn-outline-success btn-sm mr-2 label-next giNextButton"
                      (click)="(general_information_form.invalid) ?  openMandatoryAlert():validateGeneralInformation()">
                      {{ "common.next" | translate }}
                    </button>
                  </mat-action-row>
                </ng-container>
                <ng-container *ngIf="EditId != null">
                  <mat-action-row class="border-top-none">
                    <button class="btn btn-outline-primary btn-sm mr-2
                      label-reset" (click)="clearForm1(general_information_form)">
                      {{ "common.reset" | translate }}
                    </button>
                    <button class="btn btn-outline-success btn-sm mr-2 label-next giNextButton"
                      (click)="(general_information_form.invalid) ?  openMandatoryAlert():validateGeneralInformation()">
                      {{ "common.next" | translate }}
                    </button>
                  </mat-action-row>
                </ng-container>
                <ng-container *ngIf="viewMoreId!=null">
                  <mat-action-row class="border-top-none">
                    <button class="btn btn-outline-success btn-sm mr-2 label-next"
                      (click)="validateGeneralInformation()">
                      {{ "common.next" | translate }}
                    </button>
                  </mat-action-row>
                </ng-container>
              </div>
            </mat-expansion-panel>
          </form>

          <ng-container *ngIf="allocation_flag == false">
            <mat-expansion-panel hideToggle [disabled]="true" class="custom-expansion-panel custom-panel-overflow">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h6>
                    {{
                    "add-funding.funding/funding information/allocation"
                    | translate
                    }}
                  </h6>
                </mat-panel-title>
                <mat-panel-description>
                  <mat-icon></mat-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>
            </mat-expansion-panel>
          </ng-container>
          <ng-container *ngIf="allocation_flag == true">
            <form id="allocation_form" [formGroup]="allocation_form" (change)="validateOnChange()">
              <mat-expansion-panel [expanded]="step === 1" (opened)="setStep(1)" hideToggle [disabled]="false"
                class="custom-expansion-panel custom-panel-overflow">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <h6>
                      {{
                      "add-funding.funding/funding information/allocation"
                      | translate
                      }}
                    </h6>
                  </mat-panel-title>
                  <mat-panel-description>
                    <mat-icon></mat-icon>
                  </mat-panel-description>
                </mat-expansion-panel-header>
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-sm-12">

                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-amount-allocated-from
                        the-financing-agreement-usd">{{
                            "add-funding.envelope-reference"
                            | translate
                            }}</span></mat-label>

                        <mat-select #envelopeRef (openedChange)="searchResponsibleOrganization.patchValue('')"
                          (selectionChange)="setValuesAccordingToEnvelope(envelopeRef.value);validateOnChange()"
                          placeholder="Select" formControlName="envelopeReference">
                          <div class="select-container" *ngIf="filteredEnvelopeReferenceOptions">
                            <mat-optgroup>
                              <mat-form-field style="width: 100%">
                                <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                  [formControl]="searchEnvelopeRefrence" />
                                <button [disableRipple]="true" *ngIf="searchEnvelopeRefrence.value" matSuffix
                                  mat-icon-button aria-label="Clear" (click)="searchEnvelopeRefrence.patchValue('')">
                                  <mat-icon>close</mat-icon>
                                </button>
                              </mat-form-field>
                            </mat-optgroup>
                            <mat-optgroup *ngIf="(filteredEnvelopeReferenceOptions
                            | async)
                            .length == 0">
                              <div>{{'common.No results found!' | translate}}</div>
                            </mat-optgroup>
                            <mat-option *ngFor="let envelopeReference of
                          filteredEnvelopeReferenceOptions
                            | async" [value]="envelopeReference">
                              {{ envelopeReference }}
                            </mat-option>
                          </div>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <ng-container *ngIf="allocation_form.controls.envelopeReference.value!=null || 
                  allocation_form.controls.envelopeReference.value!='Select' ||
                  allocation_form.controls.envelopeReference.value!=''">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-amount-allocated-from
                          the-financing-agreement-mzn">{{
                              "add-funding.envelope-amount-mzn"
                              | translate
                              }}</span></mat-label>
                          <input matInput maxlength="100" placeholder="" formControlName="envelopeAmountMzn" />
                          <!-- <mat-hint align="end">{{input.value?.length || 0}}/100</mat-hint> -->
                        </mat-form-field>
                      </div>
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-amount-allocated-from
                          the-financing-agreement-usd">{{
                              "add-funding.envelope-amount-usd"
                              | translate
                              }}</span></mat-label>
                          <input matInput placeholder="" formControlName="envelopeAmountUsd" />
                          <!-- <mat-hint align="end">{{geo_comment.value?.length || 0}}/150</mat-hint> -->
                        </mat-form-field>
                      </div>
                    </ng-container>
                  </div>
                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <ng-container *ngIf="amount_allocated_in_financing_agreement_mandatory_flag
                        ==
                        true">
                        <strong class="mandatory">*</strong>
                      </ng-container>
                      <ng-container *ngIf="amount_allocated_in_financing_agreement_mandatory_flag
                        ==
                        false">
                      </ng-container>
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-amount-allocated">{{
                            "add-funding.amount-allocated (Financing Agreement)"
                            | translate
                            }}</span>
                        </mat-label>

                        <input type="text" (focus)="editAllocatedAmount($event.target.value)" (blur)="viewAllocatedAmount($event.target.value);
                          showGrantEquivalentFields();getCurrency()" (keypress)="regex_amount($event);" matInput
                          maxlength="100" placeholder="" autocomplete="off"
                          formControlName="amount_allocated_in_financing_agreement" />
                        <!-- <mat-error *ngIf="hasError2('amount_allocated_in_financing_agreement', 'required')">Amount allocated(financing agreement) is Required</mat-error> -->
                      </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <strong class="mandatory">*</strong>
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-currency-of-the-financing-agreement">{{
                            "add-funding.currency-of-the-financing-agreement"
                            | translate
                            }}</span></mat-label>
                        <mat-select (openedChange)="searchAllocationCurrency.patchValue('')" (selectionChange)="getCurrency();validateOnChange();setCommitmentCurrency();
                          showGrantEquivalentFields()" placeholder="Select"
                          formControlName="currency_of_the_financing_agreement">
                          <div class="select-container" *ngIf="currencyfilteredOption">
                            <mat-optgroup>
                              <mat-form-field style="width: 100%">
                                <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                  [formControl]="searchAllocationCurrency" />
                                <button [disableRipple]="true" *ngIf="searchAllocationCurrency.value" matSuffix
                                  mat-icon-button aria-label="Clear" (click)="searchAllocationCurrency.patchValue('')">
                                  <mat-icon>close</mat-icon>
                                </button>
                              </mat-form-field>
                            </mat-optgroup>
                            <mat-optgroup *ngIf="(currencyfilteredOption |
                              async).length == 0">
                              <div>{{'common.No results found!' | translate}}</div>
                            </mat-optgroup>
                            <mat-option *ngFor="let option of
                              currencyfilteredOption | async" [value]="option.currency_shortname">
                              {{
                              option.currency_fullname +
                              " (
                              " +
                              option.currency_shortname +
                              "
                              )"
                              }}
                            </mat-option>
                          </div>
                        </mat-select>
                      </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-exchange-rates-in-usd">{{
                            "add-funding.exchange-rates (USD)"
                            | translate
                            }}</span></mat-label>
                        <input matInput #input maxlength="100" placeholder="" formControlName="exchange_rates_in_usd" />
                        <!-- <mat-hint align="end">{{input.value?.length || 0}}/100</mat-hint> -->
                      </mat-form-field>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-exchange-rates-in-mzn">{{
                            "add-funding.exchange-rates (MZN)"
                            | translate
                            }}</span></mat-label>
                        <input matInput #input maxlength="100" placeholder="" formControlName="exchange_rates_in_mzn" />
                        <!-- <mat-hint align="end">{{input.value?.length || 0}}/100</mat-hint> -->
                      </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-amount-allocated-from
                            the-financing-agreement-mzn">{{
                            "add-funding.amount-allocated-in-the-financing-agreement (MZN)"
                            | translate
                            }}</span></mat-label>
                        <input matInput maxlength="100" placeholder=""
                          formControlName="amount_allocated_from_the_financing_agreement_in_meticais" />
                        <!-- <mat-hint align="end">{{input.value?.length || 0}}/100</mat-hint> -->
                      </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-amount-allocated-from
                            the-financing-agreement-usd">{{
                            "add-funding.amount-allocated-in-financing-agreement (USD)"
                            | translate
                            }}</span></mat-label>
                        <input matInput placeholder=""
                          formControlName="amount_allocated_from_financing_agreement_in_usd" />
                        <!-- <mat-hint align="end">{{geo_comment.value?.length || 0}}/150</mat-hint> -->
                      </mat-form-field>
                    </div>

                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <strong class="mandatory">*</strong>
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-type-of-finance">{{
                            "add-funding.type-of-finance" | translate
                            }}</span></mat-label>
                        <mat-select (openedChange)="searchTypeOfFinance.patchValue('')" (selectionChange)="validateOnChange();
                          showGrantEquivalentFields()" placeholder="Select" formControlName="type_of_finance">
                          <div class="select-container" *ngIf="typeOfFinancefilteredOption">
                            <mat-optgroup>
                              <mat-form-field style="width: 100%">
                                <input autocomplete="off" placeholder="Search" aria-label="Search" matInput
                                  [formControl]="searchTypeOfFinance" />
                                <button [disableRipple]="true" *ngIf="searchTypeOfFinance.value" matSuffix
                                  mat-icon-button aria-label="Clear" (click)="searchTypeOfFinance.patchValue('')">
                                  <mat-icon>close</mat-icon>
                                </button>
                              </mat-form-field>
                            </mat-optgroup>
                            <mat-optgroup *ngIf="(typeOfFinancefilteredOption |
                              async).length == 0">
                              <div>{{'common.No results found!' | translate}}</div>
                            </mat-optgroup>
                            <ng-container *ngIf="browserLang == 'en'">
                              <mat-option *ngFor="let option of
                              typeOfFinancefilteredOption | async" [value]="option.typeOfFinanceId">
                                <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                  <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                                </ng-container>
                                {{ option.typeOfFinanceName }}
                              </mat-option>
                            </ng-container>
                            <ng-container *ngIf="browserLang == 'pt'">
                              <mat-option *ngFor="let option of
                                typeOfFinancefilteredOption | async" [value]="option.typeOfFinanceId">
                                <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                  <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                                </ng-container>
                                {{ option.typeOfFinanceNamePt }}
                              </mat-option>
                            </ng-container>
                          </div>
                        </mat-select>
                      </mat-form-field>
                      <!-- <i class="fas fa-info-circle info-font mr-3 carte_button"></i> -->
                      <div class="carte custom-carte">
                        <ul>
                          <li>
                            {{
                            "funding-info.type-of-finance-value1" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value1desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value2" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value2desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value3" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value3desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value14" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value14desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value4desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value4" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value5desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value5" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value6desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value6" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value7desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value8" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value8desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value9" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value9desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value10" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value10desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value11" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value11desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value12" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value12desc"
                            | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value13" | translate
                            }}
                          </li>
                          <li>
                            {{
                            "funding-info.type-of-finance-value13desc"
                            | translate
                            }}
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-sm-12" *ngIf="grantEquivalentFieldsVisible">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-total-amount-allocated(mzn)">{{
                            "add-funding.amount-allocated-grant-eq(mzn)"
                            | translate
                            }}
                          </span>
                        </mat-label>
                        <input type="text" matInput autocomplete="off" class="" formControlName="grantEquivalentMzn"
                          id="grantEquivalentMzn" (focus)="editGrantAmountMzn($event.target.value)"
                          (blur)="viewGrantAmountMzn($event.target.value)"
                          (keypress)="regex_amount_($event, 'grantEquivalentMzn')"
                          (change)="convertUsdMzn('grantEquivalentMzn')" />
                      </mat-form-field>
                    </div>
                    <div class="col-xl-4 col-lg-4 col-sm-12" *ngIf="grantEquivalentFieldsVisible">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-total-amount-allocated(usd)">{{
                            "add-funding.amount-allocated-grant-eq(usd)"
                            | translate
                            }}
                          </span>
                        </mat-label>
                        <input type="text" matInput autocomplete="off" class="" formControlName="grantEquivalentUsd"
                          id="grantEquivalentUsd" (focus)="editGrantAmountUsd($event.target.value)"
                          (blur)="viewGrantAmountUsd($event.target.value)"
                          (keypress)="regex_amount_($event, 'grantEquivalentUsd')"
                          (change)="convertUsdMzn('grantEquivalentUsd')" />
                      </mat-form-field>
                    </div>
                  </div>
                  <button class="checkValidation" [hidden]="true">
                  </button>
                  <ng-container *ngIf="EditId == null &&
                  viewMoreId==null">
                    <mat-action-row class="border-top-none">
                      <button class="btn btn-outline-primary btn-sm mr-2
                        label-reset" (click)="clearForm2(allocation_form)">
                        {{ "common.reset" | translate }}
                      </button>
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next allocationNextButton"
                        (click)="(allocation_form.invalid) ?  openMandatoryAlert():validateAllocation()">
                        {{ "common.next" | translate }}
                      </button>

                    </mat-action-row>
                  </ng-container>
                  <ng-container *ngIf="EditId != null">
                    <mat-action-row class="border-top-none">
                      <button class="btn btn-outline-primary btn-sm mr-2
                        label-reset" (click)="clearForm2(allocation_form)">
                        {{ "common.reset" | translate }}
                      </button>
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next allocationNextButton"
                        (click)="(allocation_form.invalid) ?  openMandatoryAlert():validateAllocation()">
                        {{ "common.next" | translate }}
                      </button>
                    </mat-action-row>
                  </ng-container>
                  <ng-container *ngIf="viewMoreId!=null">
                    <mat-action-row class="border-top-none">
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next" (click)="validateAllocation()">
                        {{ "common.next" | translate }}
                      </button>
                    </mat-action-row>
                  </ng-container>
                </div>
              </mat-expansion-panel>
            </form>
          </ng-container>

          <ng-container *ngIf="commitments_flag == false">
            <mat-expansion-panel hideToggle [disabled]="true" class="custom-expansion-panel custom-panel-overflow">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <h6>
                    {{
                    "add-funding.funding/funding information/commitment"
                    | translate
                    }}
                  </h6>
                </mat-panel-title>
                <mat-panel-description>
                  <mat-icon></mat-icon>
                </mat-panel-description>
              </mat-expansion-panel-header>
            </mat-expansion-panel>
          </ng-container>
          <form id="commitment_form" [formGroup]="commitment_form" (change)="validateOnChange()">
            <ng-container *ngIf="commitments_flag == true">
              <mat-expansion-panel [expanded]="step === 2" (opened)="setStep(2)" hideToggle [disabled]="false"
                class="custom-expansion-panel custom-panel-overflow">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <h6>
                      {{
                      "add-funding.funding/funding information/commitment"
                      | translate
                      }}
                    </h6>
                  </mat-panel-title>
                  <mat-panel-description>
                    <mat-icon></mat-icon>
                  </mat-panel-description>
                </mat-expansion-panel-header>
                <div class="container-fluid">
                  <div class="row">
                    <div class="col-xl-12 col-lg-12 col-sm-12">
                      <div class="table-responsive">
                        <table class="table table-striped table-bordered" formArrayName="tableData" id="mainTable">
                          <tr>
                            <th class="add-width">
                            <ng-container *ngIf="viewMoreId==null">
                             
                                <button (click)="checkCommitment();" class="btn btn-success btn-sm"
                                  [disabled]="addButtonDisable">
                                  {{ "common.add" | translate }}
                                </button>
                              
                            </ng-container>
                            <ng-container *ngIf="viewMoreId!=null">
                              
                            </ng-container>
                            </th>
                            <th *ngFor="let column of listofCommitmentColumns">
                              <ng-container *ngIf="column === 'Year'">
                                {{ "add-funding.year" | translate }}
                              </ng-container>
                              <ng-container *ngIf="column === 'Amount' && onBudget == false">
                                {{ "add-funding.amount" | translate }}
                              </ng-container>
                              <ng-container *ngIf="column === 'Amount' && onBudget == true">
                                {{
                                "add-funding.amountColNameForOnBudget" | translate
                                }}
                              </ng-container>
                              <ng-container *ngIf="column === 'Currency'">
                                {{ "add-funding.currency" | translate }}
                              </ng-container>
                              <ng-container *ngIf="column ===
                                'Amount (MZN)'">
                                {{ "add-funding.amtmzn" | translate }}
                              </ng-container>
                              <ng-container *ngIf="column ===
                                'Amount (USD)'">
                                {{ "add-funding.amtusd" | translate }}
                              </ng-container>
                              <ng-container *ngIf="column ===
                                'Amount committed in the National Budget (MZN)'">
                                {{
                                "add-funding.amt-comtd-in-natnl-bdgt-mzn"
                                | translate
                                }}
                              </ng-container>
                              <ng-container *ngIf="column ===
                                'Amount committed in the National Budget (USD)'">
                                {{
                                "add-funding.amt-comtd-in-natnl-bdgt-usd"
                                | translate
                                }}
                              </ng-container>
                            </th>
                          </tr>
                          <tr *ngFor="let creds of commitment_form.get('tableData')[
                            'controls'
                            ];
                            let j= index">
                            <ng-container *ngIf="viewMoreId==null">
                              <ng-container *ngIf="flag_delete == false">
                                <td class="text-center">
                                  <a popover-trigger="'mouseenter'" uib-popover="Delete"
                                    class="btn btn-danger btn-sm mt-3" placement="top" ngbTooltip="{{
                                    'add-funding.delete' | translate
                                    }}">
                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                  </a>
                                </td>
                              </ng-container>
                              
                              <ng-container *ngIf="flag_delete == true">
                                <td class="text-center">
                                  <a popover-trigger="'mouseenter'" uib-popover="Delete" (click)="deleteRowYears(j)"
                                    class="btn btn-danger btn-sm mt-3" placement="top" ngbTooltip="{{
                                    'add-funding.delete' | translate
                                    }}">
                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                  </a>
                                </td>
                              </ng-container>
                            </ng-container>
                            <ng-container *ngIf="viewMoreId!=null">
                              <td></td>
                            </ng-container>

                            <td *ngFor="let column of listofCommitmentColumns">
                              <ng-container>
                                <ng-container [formGroupName]="j">
                                  <ng-container *ngIf="column === 'Year'; then
                                    loggedIn">
                                  </ng-container>
                                  <ng-template #loggedIn>
                                    <div class="col-xl-12 col-lg-12 col-sm-12">
                                      <!-- <strong class="mandatory">*</strong> -->
                                      <mat-form-field class="mb-form-0" appearance="outline">
                                        <mat-label><span class="label-year">{{
                                            "create-envelope.enter-year"
                                            | translate
                                            }}
                                          </span>
                                        </mat-label>
                                        <!-- <input matInput type="number" autocomplete="off" min="0" max="9999" onKeyUp="if(this.value>9999){this.value='9999';}else if(this.value<0){this.value='2000';}" formControlName="year" placeholder="Enter in YYYY format" /> -->
                                        <mat-select formControlName="year"
                                          (selectionChange)="checkCommitmentYear(j);getCurrencyCommitment(j);addAmountInNationalBudget(j)">
                                          <mat-option *ngFor="let year of
                                            yearArr[j]" [value]="year">
                                            {{ year }}
                                          </mat-option>
                                        </mat-select>
                                      </mat-form-field>
                                    </div>
                                  </ng-template>
                                  <ng-container *ngIf="column === 'Amount'; then
                                    loggedIn1">
                                  </ng-container>
                                  <ng-template #loggedIn1>
                                    <mat-form-field class="mb-form-0" appearance="outline">
                                      <mat-label><span class="label-amount(agreement-currency)">{{
                                          "add-funding.amount (Agreement Currency)"
                                          | translate
                                          }}
                                        </span></mat-label>
                                      <input (blur)="getCurrencyCommitment(j);addAmountInNationalBudget(j)" matInput
                                        type="text" placeholder="0.00" autocomplete="off"
                                        formControlName="amounts_of_annual_commitments_agreement_currency" (focus)="editAnnualAmount($event.target.value,
                                        j)" (blur)="viewAnnualAmount($event.target.value,
                                        j)" (keypress)="regex_amount($event)" />
                                    </mat-form-field>
                                  </ng-template>
                                  <ng-container *ngIf="column === 'Currency'; then
                                    loggedIn2">
                                  </ng-container>
                                  <ng-template #loggedIn2>
                                    <div class="col-xl-12 col-lg-12 col-sm-12">
                                      <mat-form-field class="mb-form-0" appearance="outline"
                                        *ngIf="currencyfilteredOptionCommitment[j]">
                                        <mat-label><span class="label-amount(agreement-currency)">{{
                                            "add-funding.currency" | translate
                                            }}</span></mat-label>
                                        <mat-select (openedChange)="openCurrencySearch(j)"
                                          (selectionChange)="getCurrencyCommitment(j);addAmountInNationalBudget(j)"
                                          placeholder="Select" formControlName="currencyName">
                                          <div class="select-container">
                                            <mat-optgroup>
                                              <mat-form-field style="width: 100%">
                                                <input #searchCommitmentCurncy autocomplete="off" placeholder="Search"
                                                  aria-label="Search" matInput
                                                  formControlName="searchCommitmentCurrency" />
                                                <button [disableRipple]="true" *ngIf="searchCommitmentCurncy.value"
                                                  matSuffix mat-icon-button aria-label="Clear" (click)="clearCurrencySearch($event,
                                                  j)">
                                                  <mat-icon>close </mat-icon>
                                                </button>
                                              </mat-form-field>
                                            </mat-optgroup>
                                            <!-- <mat-optgroup *ngIf="(currencyfilteredOptionCommitment[j] | async).length == 0">
                                                                                          <div>{{'common.No results found!' | translate}}</div>
                                                                                      </mat-optgroup> -->
                                            <mat-option *ngFor="let option of
                                              currencyfilteredOptionCommitment[
                                              j
                                              ] | async" [value]="option.currency_shortname">
                                              {{
                                              option.currency_fullname +
                                              "
                                              (
                                              " +
                                              option.currency_shortname +
                                              "
                                              )"
                                              }}
                                            </mat-option>
                                          </div>
                                        </mat-select>
                                      </mat-form-field>
                                    </div>
                                  </ng-template>
                                  <ng-container *ngIf="column === 'Amount (MZN)' && nodisplay === false;
                                    then loggedIn3">
                                  </ng-container>
                                  <ng-template #loggedIn3>
                                    <mat-form-field class="mb-form-0" appearance="outline">
                                      <mat-label><span class="label-amounts-of-annual-envelopes(MZN)">{{
                                          "add-funding.amounts-of-annual-commitments (MZN)"
                                          | translate
                                          }}
                                        </span>
                                      </mat-label>
                                      <input matInput type="text" autocomplete="off"
                                        formControlName="amounts_of_annual_commitments_in_meticais"/>
                                    </mat-form-field>
                                  </ng-template>
                                  <ng-container *ngIf="column ===
                                    'Amount (USD)' && nodisplay === false;
                                    then loggedIn5">
                                  </ng-container>
                                  <ng-template #loggedIn5>
                                    <mat-form-field class="mb-form-0" appearance="outline">
                                      <mat-label><span class="label-annual-envelope-amounts(USD)">
                                          {{
                                          "add-funding.amounts-of-annual-commitments (USD)"
                                          | translate
                                          }}
                                        </span>
                                      </mat-label>
                                      <input matInput type="text" autocomplete="off"
                                        formControlName="amounts_of_annual_commitments_in_usd" />
                                    </mat-form-field>
                                  </ng-template>
                                  <ng-container *ngIf="column ===
                                    'Amount committed in the National Budget (MZN)';
                                    then loggedIn6">
                                  </ng-container>
                                  <ng-template #loggedIn6>
                                    <mat-form-field class="mb-form-0" appearance="outline">
                                      <mat-label><span class="label-amount-committed-in-national-budget">
                                          {{
                                          "add-funding.amount-committed-in-national-budget-mzn"
                                          | translate
                                          }}
                                        </span>
                                      </mat-label>
                                      <input matInput type="text" autocomplete="off"
                                        formControlName="amount_committed_in_nationalBudget_mzn" />
                                    </mat-form-field>
                                  </ng-template>
                                  <ng-container *ngIf="column ===
                                    'Amount committed in the National Budget (USD)'; then loggedIn7">
                                  </ng-container>
                                  <ng-template #loggedIn7>
                                    <mat-form-field class="mb-form-0" appearance="outline">
                                      <mat-label><span>
                                          {{
                                          "add-funding.amount-committed-in-national-budget-usd"
                                          | translate
                                          }}
                                        </span>
                                      </mat-label>
                                      <input matInput type="text" autocomplete="off"
                                        formControlName="amount_committed_in_nationalBudget_usd" />
                                    </mat-form-field>
                                  </ng-template>
                                </ng-container>
                              </ng-container>
                            </td>
                          </tr>
                          <tfoot>
                            <tr>
                              <td>Total</td>
                              <td>-</td>
                              <td>{{sumOfCommitmentAmount}}</td>
                              <td>-</td>
                              <td>
                                <!-- <mat-form-field class="mb-form-0"
                                appearance="outline">
                                <mat-label><span class="label-annual-envelope-amounts(USD)">
                                    {{
                                    "add-funding.total-commitment-amount-mzn"
                                    | translate
                                    }}
                                  </span>
                                </mat-label>
                                <input matInput type="text"
                                  autocomplete="off" [value]="sumOfCommitmentAmountMzn" disabled
                                  />
                              </mat-form-field> -->
                                {{sumOfCommitmentAmountMzn}}
                              </td>
                              <td>
                                <!-- <mat-form-field class="mb-form-0"
                                appearance="outline">
                                <mat-label><span class="label-annual-envelope-amounts(USD)">
                                    {{
                                    "add-funding.total-commitment-amount-usd" 
                                    | translate
                                    }}
                                  </span>
                                </mat-label>
                                <input matInput type="text"
                                  autocomplete="off" [value]="sumOfCommitmentAmountUsd"
                                  disabled
                                  />
                              </mat-form-field> -->
                                {{sumOfCommitmentAmountUsd}}
                              </td>
                              <td>{{sumofNationalAmountMzn}}</td>
                              <td>{{sumofNationalAmountUsd}}</td>
                            </tr>
                          </tfoot>
                        </table>
                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <div class="col-xl-4 col-lg-4 col-sm-12">
                      <mat-form-field appearance="outline" class="mb-form-0">
                        <mat-label><span class="label-meo-resource-source">
                            {{
                            "add-funding.MEO-resource-source" | translate
                            }}</span></mat-label>
                            <input type="text" placeholder="Pick
                          one" aria-label="Number" matInput formControlName="meo_resource_source"
                          />
                        <!-- <input type="text" placeholder="Pick
                          one" aria-label="Number" matInput formControlName="meo_resource_source"
                          [matAutocomplete]="autoMeoResourceSource" />
                        <mat-autocomplete autoActiveFirstOption #autoMeoResourceSource="matAutocomplete"
                          [displayWith]="displayMeoResource.bind(this)">
                          <mat-option *ngFor="let option of
                            meoResourceSourcefilteredOption
                            | async" [value]="option.meoResourceSourceId">
                            {{ option.meoResourceSourceName }}
                          </mat-option>
                        </mat-autocomplete> -->
                      </mat-form-field>
                    </div>
                  </div>

                  <ng-container *ngIf="EditId == null &&
                  viewMoreId==null">
                    <mat-action-row class="border-top-none">
                      <button class="btn btn-outline-primary btn-sm mr-2
                        label-reset" type="reset" (click)="clearForm3(commitment_form)">
                        {{ "common.reset" | translate }}
                      </button>
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next commitmentNextButton"
                        (click)="(commitment_form.invalid) ?  openMandatoryAlert():validateCommitment()"
                        [disabled]="commitment_form.valid!=true">
                        {{ "common.next" | translate }}
                      </button>
                    </mat-action-row>
                  </ng-container>
                  <ng-container *ngIf="EditId != null">
                    <mat-action-row class="border-top-none">
                      <button class="btn btn-outline-primary btn-sm mr-2
                        label-reset" type="reset" (click)="clearForm3(commitment_form)">
                        {{ "common.reset" | translate }}
                      </button>
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next commitmentNextButton"
                        (click)="(commitment_form.invalid) ?  openMandatoryAlert():validateCommitment()"
                        [disabled]="commitment_form.valid!=true">
                        {{ "common.next" | translate }}
                      </button>
                    </mat-action-row>
                  </ng-container>
                  <ng-container *ngIf="viewMoreId != null">
                    <mat-action-row class="border-top-none">
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next" (click)="validateCommitmentForViewMore()">
                        {{ "common.next" | translate }}
                      </button>
                    </mat-action-row>
                  </ng-container>
                </div>
              </mat-expansion-panel>
            </ng-container>
            <form id="disbursement_form" [formGroup]="disbursement_form" (change)="validateOnChange()">
              <ng-container *ngIf="disbursement_flag == true">
                <mat-expansion-panel [expanded]="step === 3" (opened)="setStep(3)" hideToggle [disabled]="false"
                  class="custom-expansion-panel custom-panel-overflow">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <h6>
                        {{
                        "add-funding.funding/funding information/disbursement"
                        | translate
                        }}
                      </h6>
                    </mat-panel-title>
                    <mat-panel-description>
                      <mat-icon></mat-icon>
                    </mat-panel-description>
                  </mat-expansion-panel-header>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-total-amount-disbursed-mzn">{{
                              "add-funding.total-amount-disbursed (MZN)"
                              | translate
                              }}</span>
                          </mat-label>
                          <input matInput maxlength="15" placeholder="" autocomplete="off"
                            formControlName="total_amount_disbursed_in_meticais" />
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-total-amount-disbursed">
                              {{
                              "add-funding.Total Amount Disbursed (USD)"
                              | translate
                              }}</span></mat-label>
                          <input matInput maxlength="15" placeholder="" autocomplete="off"
                            formControlName="total_amount_disbursed_in_usd" />
                        </mat-form-field>
                      </div>
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-disbursement-rate">{{
                              "add-funding.DisbursementRate" | translate
                              }}</span>
                          </mat-label>
                          <input matInput maxlength="15" placeholder="" autocomplete="off"
                            formControlName="disbursement_fee" />
                        </mat-form-field>
                      </div>
                    </div>
                    <!-- <div class="row"> -->
                    <ng-container *ngIf="EditId != null || viewMoreId != null">
                      <mat-label><span class="label-list-of-disbursment">
                          <h6>
                            {{
                            "add-funding.List Of Disbursement"
                            | translate
                            }}
                          </h6>
                        </span></mat-label>
                      <div class="mat-elevation-z8">
                        <table id="ExampleMaterialTable" #disbursementSort="matSort" mat-table
                          [dataSource]="disbursementdataSource" class="table table-responsive table-bordered" matSort>

                          <ng-container matColumnDef="disbursementReference">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100">
                              {{'view-disbursement.disbursement-reference' | translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.disbursementReference}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>
                          <ng-container matColumnDef="projectTitle">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width100">
                              {{'view-disbursement.project' | translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.projectTitle}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>
                          <ng-container matColumnDef="fundingTitle">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150">
                              {{'view-disbursement.funding-title' | translate}} </th>
                            <td mat-cell *matCellDef="let element"> {{element.fundingTitle}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>
                          <ng-container matColumnDef="amount">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150">
                              {{'view-disbursement.amount-currency' | translate}} </th>
                            <td mat-cell *matCellDef="let element" style="text-align: right;">{{element.amount}}</td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> {{ totalDisbursementAmnt |
                              number : '1.2-2' }} </td>
                          </ng-container>
                          <ng-container matColumnDef="currency">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150">
                              {{'view-disbursement.disbursementCurrency' | translate}} </th>
                            <td mat-cell *matCellDef="let element"> {{element.currency}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>
                          <ng-container matColumnDef="disbursementAmountMZN">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150">
                              {{'view-disbursement.amount-mzn' | translate}} </th>
                            <td mat-cell *matCellDef="let element" style="text-align: right;">
                              {{element.disbursementAmountMZN }} </td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> {{totalDisbursementAmntMzn
                              | number : '1.2-2'}} </td>

                          </ng-container>
                          <ng-container matColumnDef="disbursementAmountUSD">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150">
                              {{'view-disbursement.amount-usd' | translate}} </th>
                            <td mat-cell *matCellDef="let element" style="text-align: right;">
                              {{element.disbursementAmountUSD }} </td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> {{totalDisbursementAmntUsd
                              | number : '1.2-2'}} </td>
                          </ng-container>

                          <ng-container matColumnDef="names">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="printremove" class="width150">
                              {{'view-disbursement.funding-organization' | translate}}</th>
                            <td mat-cell *matCellDef="let element" class="printremove"> {{element.names}} </td>
                            <td mat-footer-cell *matFooterCellDef class="printremove"> - </td>
                          </ng-container>

                          <ng-container matColumnDef="date">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150">
                              {{'view-disbursement.disbursement-date' | translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.date}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>

                          <ng-container matColumnDef="swiftcode">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="printremove" class="width150">
                              {{'view-disbursement.swift-code-ib' | translate}}</th>
                            <td mat-cell *matCellDef="let element" class="printremove"> {{element.swiftcode}} </td>
                            <td mat-footer-cell *matFooterCellDef class="printremove"> - </td>
                          </ng-container>

                          <ng-container matColumnDef="receivedswiftcode">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="printremove" class="width150">
                              {{'view-disbursement.swift-code-rb' | translate}}</th>
                            <td mat-cell *matCellDef="let element" class="printremove"> {{element.receivedswiftcode}}
                            </td>
                            <td mat-footer-cell *matFooterCellDef class="printremove"> - </td>
                          </ng-container>

                          <ng-container matColumnDef="receivedBankNIB">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="width150" class="printremove">
                              {{'view-disbursement.receiving-bank-nib' | translate}}</th>
                            <td mat-cell *matCellDef="let element" class="printremove"> {{element.receivedBankNIB}}
                            </td>
                            <td mat-footer-cell *matFooterCellDef class="printremove"> - </td>
                          </ng-container>

                          <ng-container matColumnDef="edit" sticky>
                            <th *matHeaderCellDef class="label-action"> {{'view-disbursement.action' | translate}} </th>
                            <td *matCellDef="let element;let i = index;" class="printremove">
                              <!-- <ng-container *ngIf="viewMoreId==null">
                                <ng-container *ngIf="userPermission.indexOf(3)!=-1">
                                  <button class="btn btn-primary btn-sm mr-1" placement="top" ngbTooltip="{{ 'create-envelope.edit' | translate }}" tabindex="-1" (click)='moveToSelectedTabDisbursement(element.disbursement_id)'>
                                      <i class="far fa-edit"></i>
                                  </button>
                          </ng-container>
                          <ng-container *ngIf="userPermission.indexOf(4)!=-1">
                                  <button class="btn btn-danger btn-sm mr-1" placement="top" ngbTooltip="{{ 'create-envelope.delete' | translate }}" tabindex="-1" (click)='opensweetalertDeleteDisbursement(element.disbursement_id)'>
                                      <i class="fas fa-trash-alt"></i>
                                  </button>
                          </ng-container>
                              </ng-container> -->
                              <ng-container *ngIf="userPermission.indexOf(2)!=-1">
                                <button class="btn btn-success btn-sm" placement="top"
                                  ngbTooltip="{{ 'create-envelope.view' | translate }}" tabindex="-1"
                                  (click)='viewMoreDisbursement(element.disbursement_id)'>
                                  <i class="fas fa-eye"></i>
                                </button>
                                &nbsp;
                                <button class="btn btn-info btn-sm" placement="top"
                                  ngbTooltip="{{ 'create-envelope.viewmore' | translate }}" tabindex="-1"
                                  (click)='openDialogDisbursement(element.disbursement_id)'>
                                  <i class="fas fa-eye"></i>
                                </button>
                              </ng-container>
                            </td>
                            <td mat-footer-cell *matFooterCellDef style="font-weight: bold;" class="printremove"> Total
                            </td>
                          </ng-container>
                          <tr mat-header-row *matHeaderRowDef="disbursementDisplayedColumns"></tr>
                          <tr mat-row *matRowDef="let row; columns: disbursementDisplayedColumns;"></tr>
                          <tr mat-footer-row *matFooterRowDef="disbursementDisplayedColumns"
                            style="background-color: #d9d9d9;"></tr>

                        </table>

                        <mat-paginator #disbursementPaginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
                        </mat-paginator>
                      </div>
                    </ng-container>
                    <!-- </div> -->
                    <ng-container *ngIf="EditId == null &&
                      viewMoreId ==null">
                      <mat-action-row class="border-top-none">
                        <!-- <button class="btn btn-outline-primary btn-sm mr-2 label-reset" type="reset">{{'common.reset' | translate}}</button> -->
                        <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                          {{ "common.previous" | translate }}
                        </button>
                        <button class="btn btn-outline-success btn-sm mr-2
                          label-next"
                          (click)="(disbursement_form.invalid) ?  openMandatoryAlert():validateDisbursement()">
                          {{ "common.next" | translate }}
                        </button>
                      </mat-action-row>
                    </ng-container>
                    <ng-container *ngIf="EditId != null">
                      <mat-action-row class="border-top-none">
                        <!-- <button class="btn btn-outline-primary btn-sm mr-2 label-reset" type="reset">{{'common.reset' | translate}}</button> -->
                        <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                          {{ "common.previous" | translate }}
                        </button>
                        <button class="btn btn-outline-success btn-sm mr-2
                          label-next"
                          (click)="(disbursement_form.invalid) ?  openMandatoryAlert():validateDisbursement()">
                          {{ "common.next" | translate }}
                        </button>
                      </mat-action-row>
                    </ng-container>
                    <ng-container *ngIf="viewMoreId!=null">
                      <mat-action-row class="border-top-none">
                        <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                          {{ "common.previous" | translate }}
                        </button>
                        <button class="btn btn-outline-success btn-sm mr-2
                          label-next" (click)="validateDisbursement()">
                          {{ "common.next" | translate }}
                        </button>
                      </mat-action-row>
                    </ng-container>
                  </div>
                </mat-expansion-panel>
              </ng-container>
            </form>
            <ng-container *ngIf="disbursement_flag == false">
              <mat-expansion-panel hideToggle [disabled]="true" class="custom-expansion-panel">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <h6>
                      {{
                      "add-funding.Funding / Funding Information / Disbursement"
                      | translate
                      }}
                    </h6>
                  </mat-panel-title>
                  <mat-panel-description>
                    <mat-icon></mat-icon>
                  </mat-panel-description>
                </mat-expansion-panel-header>
              </mat-expansion-panel>
            </ng-container>
            <ng-container *ngIf="payments_flag == false">
              <mat-expansion-panel hideToggle [disabled]="true" class="custom-expansion-panel custom-panel-overflow">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <h6>
                      {{
                      "add-funding.Funding / Funding Information / Payment"
                      | translate
                      }}
                    </h6>
                  </mat-panel-title>
                  <mat-panel-description>
                    <mat-icon></mat-icon>
                  </mat-panel-description>
                </mat-expansion-panel-header>
              </mat-expansion-panel>
            </ng-container>
            <form id="payment_form" [formGroup]="payment_form" (change)="validateOnChange()">
              <ng-container *ngIf="payments_flag == true">
                <mat-expansion-panel [expanded]="step === 4" (opened)="setStep(4)" hideToggle [disabled]="false"
                  class="custom-expansion-panel custom-panel-overflow">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <h6>
                        {{
                        "add-funding.Funding / Funding Information / Payment"
                        | translate
                        }}
                      </h6>
                    </mat-panel-title>
                    <mat-panel-description>
                      <mat-icon></mat-icon>
                    </mat-panel-description>
                  </mat-expansion-panel-header>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-amount-paid-mzn">{{
                              "add-funding.Amount Paid (MZN)"
                              | translate
                              }}</span></mat-label>
                          <input matInput maxlength="15" placeholder="" autocomplete="off"
                            formControlName="amount_paid_in_meticais" />
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-amount-paid-usd">
                              {{
                              "add-funding.Amount Paid (USD)"
                              | translate
                              }}</span></mat-label>
                          <input matInput maxlength="15" placeholder="" autocomplete="off"
                            formControlName="amount_paid_in_usd" />
                        </mat-form-field>
                      </div>
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-financial-execution-rate">
                              {{
                              "add-funding.Financial Execution Rate"
                              | translate
                              }}</span>
                          </mat-label>
                          <input matInput maxlength="15" placeholder="" autocomplete="off"
                            formControlName="financial_execution_rate" />
                        </mat-form-field>
                      </div>
                    </div>
                    <ng-container *ngIf="EditId != null || viewMoreId != null">
                      <mat-label><span class="label-payment-list">
                          <h6>{{ "add-funding.payment-list" | translate }}</h6>
                        </span></mat-label>
                      <div class="mat-elevation-z8">
                        <table id="ExampleMaterialTable" #paymentSort='matSort' mat-table
                          [dataSource]="paymentdataSource" class="table table-responsive table-bordered" matSort>

                          <ng-container matColumnDef="paymentReference">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.payment-reference' |
                              translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.paymentReference}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>

                          <ng-container matColumnDef="stateBudget">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.state-budget' |
                              translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.stateBudget}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>




                          <ng-container matColumnDef="fundingDonorTitle">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.Financing Agreement' |
                              translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.fundingDonorTitle}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>


                          <ng-container matColumnDef="projectTitle">
                            <th mat-header-cell *matHeaderCellDef class="label-region-type" mat-sort-header>
                              {{'view-payment.Project' | translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.projectTitle}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>

                          <ng-container matColumnDef="UGBMEO">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="printremove">
                              {{'view-payment.UGB MEO' | translate}}</th>
                            <td mat-cell *matCellDef="let element" class="printremove"> {{element.UGBMEO}} </td>
                            <td mat-footer-cell *matFooterCellDef class="printremove"> - </td>
                          </ng-container>

                          <ng-container matColumnDef="MEOResourceSources">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header class="printremove">
                              {{'view-payment.MEO Resource Sources' | translate}}</th>
                            <td mat-cell *matCellDef="let element" class="printremove"> {{element.MEOResourceSources}}
                            </td>
                            <td mat-footer-cell *matFooterCellDef class="printremove"> - </td>
                          </ng-container>

                          <ng-container matColumnDef="paymentDate">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.Payment Date' |
                              translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.paymentDate}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>

                          <ng-container matColumnDef="amount">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.paymentAmount' |
                              translate}}</th>
                            <!-- <td mat-cell *matCellDef="let element" style="text-align: right;"> {{element.amount}} </td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> - </td> -->
                            <td mat-cell *matCellDef="let element" style="text-align: right;">{{element.amount}}</td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> {{ totalAmntPayment |
                              number : '1.2-2' }} </td>
                          </ng-container>

                          <ng-container matColumnDef="currency">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.paymentCurrency' |
                              translate}}</th>
                            <td mat-cell *matCellDef="let element"> {{element.currency}} </td>
                            <td mat-footer-cell *matFooterCellDef> - </td>
                          </ng-container>

                          <ng-container matColumnDef="paymentAmountMZN">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.Payment Amount (MZN)'
                              | translate}}</th>
                            <td mat-cell *matCellDef="let element" style="text-align: right;">
                              {{element.paymentAmountMZN}} </td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> {{totalAmntMZNPayment |
                              number : '1.2-2'}} </td>

                          </ng-container>

                          <ng-container matColumnDef="paymentAmountUSD">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>{{'view-payment.Payment Amount (USD)'
                              | translate}}</th>
                            <td mat-cell *matCellDef="let element" style="text-align: right;">
                              {{element.paymentAmountUSD }} </td>
                            <td mat-footer-cell *matFooterCellDef style="text-align: right;"> {{totalAmntUsdPayment |
                              number : '1.2-2'}} </td>
                          </ng-container>
                          <ng-container matColumnDef="edit" sticky>
                            <th *matHeaderCellDef class="label-action"> {{'common.action' | translate}} </th>
                            <td *matCellDef="let element;let i = index;" class="printremove">
                              <!-- <ng-container *ngIf="viewMoreId==null">
                                <ng-container *ngIf="userPermission.indexOf(3)!=-1">
                                    <button class="btn btn-primary btn-sm mr-1" placement="top" ngbTooltip="{{'common.edit' | translate}}" tabindex="-1" (click)='moveToSelectedTabPayment(element.payment_id)'>
                                        <i class="far fa-edit"></i>
                                    </button>
                                </ng-container>
                                <ng-container *ngIf="userPermission.indexOf(4)!=-1">
                                    <button class="btn btn-danger btn-sm mr-1" placement="top" ngbTooltip="{{'common.delete' | translate}}" tabindex="-1" (click)='opensweetalertDeletePayment(element.payment_id)'>
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </ng-container>
                                </ng-container> -->
                              <ng-container *ngIf="userPermission.indexOf(2)!=-1">
                                <button class="btn btn-success btn-sm" placement="top"
                                  ngbTooltip="{{'common.view' | translate}}" tabindex="-1"
                                  (click)='viewMorePayment(element.payment_id)'> <i class="fas fa-eye"></i> </button>
                                &nbsp;
                                <button class="btn btn-info btn-sm" placement="top"
                                  ngbTooltip="{{ 'create-envelope.viewmore' | translate }}" tabindex="-1"
                                  (click)='openDialogPayment(element.payment_id)'>
                                  <i class="fas fa-eye"></i>
                                </button>
                              </ng-container>
                            </td>
                            <td mat-footer-cell class="printremove" *matFooterCellDef style="font-weight: bold;"> Total
                            </td>

                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="paymentDisplayedColumns"></tr>
                          <tr mat-row *matRowDef="let row; columns: paymentDisplayedColumns;"></tr>
                          <tr mat-footer-row *matFooterRowDef="paymentDisplayedColumns"
                            style="background-color: #d9d9d9;"></tr>

                        </table>

                        <mat-paginator #paymentPaginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
                        </mat-paginator>
                      </div>
                    </ng-container>
                    <mat-action-row>
                      <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                        {{ "common.previous" | translate }}
                      </button>
                      <button class="btn btn-outline-success btn-sm mr-2
                        label-next" (click)="validatePayment()">
                        {{ "common.next" | translate }}
                      </button>
                    </mat-action-row>
                  </div>
                </mat-expansion-panel>
              </ng-container>
            </form>

            <ng-container *ngIf="location_flag == false">
              <mat-expansion-panel hideToggle [disabled]="true" class="custom-expansion-panel custom-panel-overflow">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <h6>
                      {{
                      "add-funding.funding/funding information/location"
                      | translate
                      }}
                    </h6>
                  </mat-panel-title>
                  <mat-panel-description>
                    <mat-icon></mat-icon>
                  </mat-panel-description>
                </mat-expansion-panel-header>
              </mat-expansion-panel>
            </ng-container>
            <ng-container *ngIf="location_flag == true">
              <form id="locationForm" [formGroup]="locationForm" (change)="validateOnChange()">
                <mat-expansion-panel [expanded]="step === 5" (opened)="setStep(5)" hideToggle [disabled]="false"
                  class="custom-expansion-panel custom-panel-overflow">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      <h6>
                        {{
                        "add-funding.funding/funding information/location"
                        | translate
                        }}
                      </h6>
                    </mat-panel-title>
                    <mat-panel-description>
                      <mat-icon></mat-icon>
                    </mat-panel-description>
                  </mat-expansion-panel-header>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-province">{{
                              "add-funding.province" | translate
                              }}</span></mat-label>
                          <mat-select #matRefProvinces (openedChange)="openProvinces($event)" placeholder="Select"
                            formControlName="provinces" multiple (selectionChange)="selectProvience()">
                            <mat-select-trigger>
                              {{
                              selectedprovincename
                              ? selectedprovincename[0]
                              : ""
                              }}
                              <span *ngIf="selectedprovincename?.length> 1" class="additional-selection">
                                (+{{ selectedprovincename.length - 1 }}
                                {{
                                selectedprovincename?.length === 2
                                ? "other"
                                : "others"
                                }})
                              </span>
                            </mat-select-trigger>
                            <div class="select-container" *ngIf="filteredOptionProvinces!=null">
                              <mat-optgroup>
                                <mat-form-field style="width: 100%">
                                  <input #searchprovinces autocomplete="off" placeholder="Search" aria-label="Search"
                                    matInput [formControl]="searchTextBoxProvinces" />
                                  <button [disableRipple]="true" *ngIf="searchprovinces.value" matSuffix mat-icon-button
                                    aria-label="Clear" (click)="searchTextBoxProvinces.patchValue('')">
                                    <mat-icon>close</mat-icon>
                                  </button>
                                </mat-form-field>
                              </mat-optgroup>
                              <mat-optgroup *ngIf="(filteredOptionProvinces |
                                  async).length == 0">
                                <div>{{'common.No results found!' | translate}}</div>
                              </mat-optgroup>
                              <mat-option (onSelectionChange)="selectionChangeProvince($event)" *ngFor="let
                                  option of filteredOptionProvinces | async" [value]="option.provinces_id">
                                <ng-container *ngIf="option.difference<=7 || option.updateDifference<=7">
                                  <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                                </ng-container>
                                {{ option.provinces_name }}
                              </mat-option>
                            </div>
                          </mat-select>
                        </mat-form-field>
                      </div>
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <mat-form-field appearance="outline" class="mb-form-0">
                          <mat-label><span class="label-districts">{{
                              "add-funding.district" | translate
                              }}</span></mat-label>
                          <mat-select #matRefDistricts formControlName="districts" multiple id="districts">
                            <div *ngIf="this.locationForm.controls['provinces'].value.length > 0">
                              <ng-container *ngFor="let provId of this.locationForm.controls['provinces'].value">
                                <mat-optgroup [label]="provname(provId)">
                                  <ng-container *ngFor="let districts of district">
                                    <ng-container *ngIf="provId===districts.provinces_id">
                                      <mat-option [value]="districts.districts_id">
                                        <ng-container *ngIf="districts.difference<=7 || districts.updateDifference<=7">
                                          <i class="fas fa-star" style="color: darkgreen;"></i> &nbsp;
                                        </ng-container>
                                        {{districts.districts_name}}
                                      </mat-option>
                                    </ng-container>
                                  </ng-container>
                                </mat-optgroup>
                              </ng-container>
                            </div>

                          </mat-select>
                        </mat-form-field>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-4 col-lg-4 col-sm-12">
                        <!-- <a class="" title="Print"><i class="fas fa-print"></i></a>  -->
                        <button type="button" mat-raised-button color="primary" (click)="getLocation()">
                          {{ "add-funding.get-location" | translate }}
                        </button>
                      </div>
                    </div>
                    <br />

                    <ng-container *ngIf="get_location_fields_hidden_flag ===
                      false">
                      <iframe width="100%" height="500" src="https://dev.mozgis.gov.mz/portal/apps/webappviewer/index.html?id=1b70e0339e684d1c8eba7868bb0efbf3&a=1332&b=Escola+da+MAtola&c=233435&d=PRODETP&e=23AB1&f=
                      Carlos+Sim%C3%B5es&g=03&h=06&i=23&j=C&k=ParcDoador&l=ParcRespo&m=MEF&embedded=true"></iframe>

                      <div class="mat-elevation-z8">
                        <table mat-table [dataSource]="dataSource3" class="table
                          table-striped table-bordered" id="location_list" matSort #locationSort="matSort">
                          <ng-container matColumnDef="userName">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{ "add-funding.User-Name" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.userName }}
                            </td>
                          </ng-container>
                          <ng-container matColumnDef="georef">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{
                              "add-funding.Geographical-Reference" | translate
                              }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.geographicalReference }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="iatiLocation">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{ "add-funding.IATI-location" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.iatiLocation }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="iatiAccuracy">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{
                              "add-funding.IATI accuracy"
                              | translate
                              }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.iatiAccuracy }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="coordinates">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              Coordinates
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.coordinates }}
                            </td>
                          </ng-container>

                          <!-- <ng-container matColumnDef="latitude">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{ "add-funding.latitude" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.latitude }}
                            </td>
                          </ng-container>

                          <ng-container matColumnDef="longitude">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{ "add-funding.longitude" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.longitude }}
                            </td>
                          </ng-container> -->

                          <ng-container matColumnDef="geoComments">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header>
                              {{ "add-funding.geolocation-comment" | translate }}
                            </th>
                            <td mat-cell *matCellDef="let element">
                              {{ element.geolocationComments }}
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="displayedColumnsForLocation"></tr>
                          <tr mat-row *matRowDef="let row;
                            columns: displayedColumnsForLocation"></tr>
                        </table>

                        <mat-paginator #locationPaginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons>
                        </mat-paginator>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="get_location_fields_hidden_flag ===
                      true">
                    </ng-container>
                    <ng-container *ngIf="EditId == null &&
                    viewMoreId==null">
                      <mat-action-row class="border-top-none">
                        <button class="btn btn-outline-primary btn-sm mr-2
                          label-reset" (click)="resetLocation()">
                          {{ "common.reset" | translate }}
                        </button>
                        <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                          {{ "common.previous" | translate }}
                        </button>
                        <!-- <button class="btn btn-outline-success btn-sm mr-2 label-next"  (click)="validateLocation()">{{'common.next' | translate}}</button> -->
                      </mat-action-row>
                    </ng-container>
                    <ng-container *ngIf="EditId != null">
                      <mat-action-row class="border-top-none">
                        <button class="btn btn-outline-primary btn-sm mr-2
                          label-reset" (click)="resetLocation()">
                          {{ "common.reset" | translate }}
                        </button>
                        <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                          {{ "common.previous" | translate }}
                        </button>
                        <!-- <button class="btn btn-outline-success btn-sm mr-2 label-next"  (click)="validateLocation()">{{'common.next' | translate}}</button> -->
                      </mat-action-row>
                    </ng-container>
                    <ng-container *ngIf="viewMoreId!=null">
                      <mat-action-row class="border-top-none">
                        <button class="btn btn-outline-danger btn-sm mr-2" (click)="prevStep()">
                          {{ "common.previous" | translate }}
                        </button>
                        <!-- <button class="btn btn-outline-success btn-sm mr-2 label-next"  (click)="validateLocation()">{{'common.next' | translate}}</button> -->
                      </mat-action-row>
                    </ng-container>
                  </div>
                </mat-expansion-panel>
              </form>
            </ng-container>
          </form>
        </mat-accordion>
        <ng-container *ngIf="EditId == null && viewMoreId==null && viewDraftedFaId==null">
          <div class="row">
            <div class="col-lg-12 mt-3 mb-2">
              <div class="example-button">
                <button class="btn btn-success mr-2" (click)="validateFinancialAgreementForms()">
                  {{ "common.submit" | translate }}
                </button>
                <button class="btn btn-primary mr-2" (click)="saveAsDraft()">
                  {{ "common.save-as-draft" | translate }}
                </button>
                <button class="btn btn-reset mr-2" (click)="clearForm()">
                  {{ "common.reset" | translate }}
                </button>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="EditId!=null">
          <div class="row">
            <div class="col-lg-12 mt-3 mb-2">
              <div class="example-button">
                <button class="btn btn-success mr-2" (click)="general_information_form.invalid ||
                  allocation_form.invalid ||
                  locationForm.invalid ||
                  commitment_form.invalid ||
                  disbursement_form.invalid ||
                  payment_form.invalid
                  ? openMandatoryAlert()
                  : opensweetalertUpdate()">
                  {{ "common.update" | translate }}
                </button>
                <button class="btn btn-primary mr-2" (click)="saveAsDraftFromEdit()">
                  {{ "common.save-as-draft" | translate }}
                </button>
                <button class="btn btn-reset mr-2" (click)="clearForm()">
                  {{ "common.reset" | translate }}
                </button>
                <button class="btn btn-danger mr-2" (click)="moveToFundingTab()">
                  {{ "common.cancel" | translate }}
                </button>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="viewMoreId!=null">
          <div class="row">
            <div class="col-lg-12 mt-3 mb-2">
              <div class="example-button">
                <button class="btn btn-danger mr-2" (click)="moveToFundingTab()">
                  {{ "common.cancel" | translate }}
                </button>
                <button class="btn btn-primary mr-2" (click)="moveToEdit()">
                  {{ "common.edit" | translate }}
                </button>
              </div>
            </div>
          </div>
        </ng-container>
        <ng-container *ngIf="viewDraftedFaId!=null">
          <div class="row">
            <div class="col-lg-12 mt-3 mb-2">
              <div class="example-button">
                <button class="btn btn-success mr-2" (click)="publish()">
                  Publish
                </button>
                <button class="btn btn-reset mr-2" (click)="discard()">
                  Discard
                </button>
                <button class="btn btn-danger mr-2" (click)="moveToFundingTab()">
                  {{ "common.cancel" | translate }}
                </button>
              </div>
            </div>
          </div>
        </ng-container>

      </div>
    </div>
  </mat-card>
</ng-container>